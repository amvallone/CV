<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Curriullum Vitae Andres Marcelo Vallone</title>
  <style>
    :root {
      --bg: #dfddcf;
      --bg-soft: #efece1;
      --primary: #3a3a2d;
      --secondary: #6a7c58;
      --accent: #bc7d38;
      --card: #f5f1e9;
      --sidebar: #5a4a3a;
      --sidebar-w: 310px;
    }
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: #2c2c2c;
      line-height: 1.5;
    }
    /* SIDEBAR FIJA */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-w);
      height: 100vh;
      background: linear-gradient(180deg, #5a4a3a 0%, #6b5a47 100%);
      box-shadow: 2px 0 12px rgba(0,0,0,0.08);
      padding: 18px 16px 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 50;
    }
    .sidebar-photo { display: flex; justify-content: center; margin-bottom: 4px; }
    .sidebar-photo img {
      width: 160px; height: 160px; border-radius: 14px; object-fit: cover;
      border: 4px solid rgba(242, 231, 209, 0.7);
      box-shadow: 0 6px 18px rgba(0,0,0,0.15); background: #ddd;
    }
    .sidebar-title { font-size: 1.05rem; font-weight: bold; color: #f5f1e9; text-align: center; line-height: 1.2; }
    .sidebar-contact {
      display: flex; flex-direction: column; gap: 6px; font-size: 0.75rem;
      align-items: flex-start; background: rgba(243, 237, 225, 0.08);
      border-radius: 8px; padding: 6px 4px;
    }
    .contact-icon { display: inline-flex; align-items: center; gap: 6px; text-decoration: none; color: #f7f4ef; font-size: 0.73rem; }
    .contact-icon svg { width: 15px; height: 15px; flex: 0 0 15px; fill: #f7f4ef; }
    .lang-btn {
      margin-top: 4px; padding: 6px 14px; border: none; background: var(--accent); color: white;
      cursor: pointer; border-radius: 5px; font-size: 0.7rem; align-self: center;
    }
    nav.sidebar-nav { margin-top: 6px; display: flex; flex-direction: column; gap: 5px; }
    nav.sidebar-nav a {
      text-decoration: none; color: #f5f1e9; font-weight: 600; font-size: 0.78rem;
      padding: 6px 10px; border-radius: 6px; transition: background 0.15s ease; background: rgba(245,241,233,0.05);
    }
    nav.sidebar-nav a:hover { background: rgba(245,241,233,0.18); }

    /* CONTENIDO */
    .main-content { margin-left: calc(var(--sidebar-w) + 16px); padding: 20px; max-width: 1000px; }
    .summary-box { background: var(--card); padding: 10px 12px; border-radius: 8px; margin-bottom: 18px; border: 1px solid rgba(0,0,0,0.01); }
    section { margin-bottom: 28px; }
    h2 { border-bottom: 2px solid rgba(90, 74, 58, 0.55); padding-bottom: 5px; margin-bottom: 15px; color: var(--primary); }
    ul { padding-left: 0; list-style: none; }

    /* Tarjetas listas */
    .edu-item, .card-list-item {
      display: flex; gap: 10px; background: #f1ede5; margin-bottom: 10px; padding: 10px 12px;
      border-radius: 8px; border: 1px solid rgba(0,0,0,0.015); box-shadow: 0 2px 4px rgba(0,0,0,0.03); align-items: flex-start;
    }
    .edu-icon, .card-icon { width: 22px; height: 22px; flex: 0 0 22px; }
    .edu-content small { color: #6b5b47; font-size: 0.73rem; }

    /* EXPERIENCIA (limpia, íconos pequeños) */
    .experience-grid { display: flex; gap: 15px; flex-wrap: wrap; }
    .exp-card {
      background: #f1ede5; flex: 1 1 380px; padding: 12px; border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.02); border-top: 3px solid rgba(146, 133, 110, 0.55);
    }
    .exp-card-header { display: flex; gap: 6px; align-items: center; margin-bottom: 6px; }
    .exp-card-header svg { width: 16px; height: 16px; fill: #5e7050; flex: 0 0 16px; }
    .exp-card h3 { margin: 0; font-size: 0.9rem; color: #3a3a2d; }
    .exp-subtitle { font-size: 0.78rem; color: #5d523f; margin-top: 8px; margin-bottom: 4px; font-weight: bold; }
    .course-list li, .other-exp-list li { display: flex; gap: 5px; align-items: flex-start; margin-bottom: 4px; font-size: 0.78rem; }
    .course-list li::before, .other-exp-list li::before { content: "•"; color: #5e7050; font-weight: bold; margin-right: 4px; }

    .skills-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    .skill-card { background: #f1ede5; border-radius: 8px; padding: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.03); }
    .award-item { background: #f1ede5; padding: 10px 12px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #bc7d38; }

    /* abstract */
    .pub-abstract {
      background: rgba(0,0,0,0.03);
      margin-top: 6px;
      padding: 6px 8px;
      border-left: 3px solid #bc7d38;
      border-radius: 4px;
      font-size: 0.74rem;
      color: #3b372f;
    }
    .pub-meta small { color: #5a4a3a; }

    @media (max-width: 900px) {
      .sidebar { position: static; width: 100%; height: auto; flex-direction: row; flex-wrap: wrap; }
      .main-content { margin-left: 0; }
      nav.sidebar-nav { flex-direction: row; flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-photo"><img src="tu-foto.JPG" alt="Foto personal" /></div>
    <div class="sidebar-title" id="title">Curriullum Vitae Andres Marcelo Vallone</div>
    <div class="sidebar-contact">
      <a class="contact-icon" href="mailto:avallone@ucn.cl" title="Enviar correo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 4H4C2.9 4 2 4.9 2 6v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
        avallone@ucn.cl
      </a>
      <a class="contact-icon" href="https://www.researchgate.net/profile/Tu-Nombre" target="_blank" rel="noopener" title="ResearchGate">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">
          <circle cx="40" cy="40" r="36" fill="#4aa471" />
          <text x="22" y="48" font-size="25" fill="#fff" font-family="Arial, sans-serif">RG</text>
        </svg>
        ResearchGate
      </a>
      <a class="contact-icon" href="https://orcid.org/0000-0000-0000-0000" target="_blank" rel="noopener" title="ORCID">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="14" height="14">
          <circle cx="128" cy="128" r="120" fill="#A6CE39"/>
          <path fill="#fff" d="M111 92h14v72h-14V92zm7-30c5 0 9 4 9 9s-4 9-9 9-9-4-9-9 4-9 9-9zm26 30h14v40c0 6 1 10 3 13 2 2 5 4 9 4 4 0 7-1 9-4 2-3 3-7 3-13V92h14v40c0 10-2 17-6 22-4 5-10 8-18 8-9 0-15-3-19-9-3-5-5-12-5-21V92z"/>
        </svg>
        ORCID: 0000-0000-0000-0000
      </a>
      <span class="contact-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 4h16v2H4V4zm2 4h12v2H6V8zm-2 4h16v2H4v-2zm2 4h12v2H6v-2z"/></svg>
        Web of Science ID:
      </span>
      <span class="contact-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 5h18v2H3V5zm0 4h14v2H3V9zm0 4h10v2H3v-2zm0 4h6v2H3v-2z"/></svg>
        Scopus ID:
      </span>
    </div>
    <button class="lang-btn" onclick="toggleLanguage()">English / Español</button>
    <nav class="sidebar-nav">
      <a href="#general" id="nav-general">Información General</a>
      <a href="#education" id="nav-education">Educación</a>
      <a href="#experience" id="nav-experience">Experiencia</a>
      <a href="#publications" id="nav-publications">Publicaciones</a>
      <a href="#projects" id="nav-projects">Proyectos</a>
      <a href="#conferences" id="nav-conferences">Presentaciones</a>
      <a href="#skills" id="nav-skills">Capacidades</a>
      <a href="#awards" id="nav-awards">Becas y Premios</a>
    </nav>
  </aside>

  <main class="main-content">
    <section id="general">
      <h2 id="general-title">Información General</h2>
      <div class="summary-box" id="summary-text">
        Profesor Asociado en la Universidad Católica del Norte (Escuela de Ciencias Empresariales / Instituto de Políticas Públicas, Coquimbo, Chile). Especializado en economía regional y urbana, redes de innovación y análisis espacial.
      </div>
      <p id="general-text">
        Afiliación actual: Universidad Católica del Norte, Escuela de Ciencias Empresariales - Instituto de Políticas Públicas, Coquimbo, Chile.
      </p>
    </section>

    <section id="education">
      <h2 id="education-title">Educación</h2>
      <ul id="education-list"></ul>
    </section>

    <section id="experience">
      <h2 id="experience-title">Experiencia</h2>
      <div class="experience-grid">
        <div class="exp-card" id="teaching-card">
          <div class="exp-card-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 3 9 4.5-9 4.5L3 7.5 12 3zm7 9.94 2 .99v2.07l-9 4.5-9-4.5v-2.07l2-.99v1.5l7 3.5 7-3.5v-1.5z"/></svg>
            <h3 id="teaching-exp-title">Experiencia docente</h3>
          </div>
          <div>
            <div class="exp-subtitle" id="undergrad-title">Pregrado</div>
            <ul id="undergrad-list" class="course-list"></ul>
          </div>
          <div>
            <div class="exp-subtitle" id="postgrad-title">Postgrado</div>
            <ul id="postgrad-list" class="course-list"></ul>
          </div>
        </div>
        <div class="exp-card" id="other-card">
          <div class="exp-card-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
            <h3 id="other-exp-title">Otras experiencias</h3>
          </div>
          <ul id="other-exp-list" class="other-exp-list"></ul>
        </div>
      </div>
    </section>

    <section id="publications">
      <h2 id="publications-title">Publicaciones</h2>
      <ul id="publications-list"></ul>
      <!-- Coloca library.bib en esta carpeta -->
    </section>

    <section id="projects">
      <h2 id="projects-title">Proyectos de investigación</h2>
      <ul id="projects-list"></ul>
    </section>

    <section id="conferences">
      <h2 id="conferences-title">Presentaciones en Congresos</h2>
      <ul id="conferences-list"></ul>
    </section>

    <section id="skills">
      <h2 id="skills-title">Capacidades</h2>
      <div class="skills-grid" id="skills-grid"></div>
    </section>

    <section id="awards">
      <h2 id="awards-title">Becas y Premios</h2>
      <div id="awards-list"></div>
    </section>
  </main>

  <script>
    /* ===== Datos bilingües base ===== */
    const content = {
      es: {
        title: "Curriullum Vitae Andres Marcelo Vallone",
        nav: ["Información General","Educación","Experiencia","Publicaciones","Proyectos","Presentaciones","Capacidades","Becas y Premios"],
        generalTitle: "Información General",
        generalText: "Afiliación: Universidad Católica del Norte, Escuela de Ciencias Empresariales - Instituto de Políticas Públicas, Coquimbo, Chile.",
        summary: "Profesor Asociado UCN. Doctor en Economía y Empresa (UAM, 2019). Líneas: economía urbana y regional, redes de innovación, concentración espacial, R para análisis socioeconómicos.",
        educationTitle: "Educación",
        education: [
          { degree: "Doctor en Economía y Empresa", institution: "Universidad Autónoma de Madrid, España", years: "2015 – 2019" },
          { degree: "Magíster en Ciencia Regional", institution: "Universidad Católica del Norte, Antofagasta, Chile", years: "2009 – 2011" },
          { degree: "MBA – Master en Administración", institution: "Universidad Católica del Norte, Coquimbo, Chile", years: "2007 – 2009" },
          { degree: "Magíster en Economía y Administración Estratégica de Negocios", institution: "Universidad Católica de Cuyo, San Juan, Argentina", years: "2006 – 2009" },
          { degree: "Licenciado en Economía", institution: "Universidad Católica de Cuyo, San Juan, Argentina", years: "1997 – 2004" }
        ],
        experienceTitle: "Experiencia",
        teachingExpTitle: "Experiencia docente",
        undergradTitle: "Pregrado",
        postgradTitle: "Postgrado",
        undergradCourses: [
          "Macroeconomía II – UCN, Coquimbo (2011–Presente)",
          "Microeconomía I – UCN, Coquimbo (2011–Presente)",
          "Microeconomía II – UCN, Coquimbo (2011–Presente)",
          "Visión del Entorno Económico y Social – UCN",
          "Introducción a la Economía – UCN",
          "Organización Industrial – UCN",
          "Optimización – UCN Antofagasta (2008–2010)",
          "Economía Internacional – UCCuyo (2005–2007)"
        ],
        postgradCourses: [
          "Apoyo a docencia e investigación, Departamento de Economía Aplicada, UAM (2016–2018)"
        ],
        otherExpTitle: "Otras experiencias",
        otherExperience: [
          "Profesor jornada completa, Universidad Católica del Norte, Coquimbo, Chile (2011–presente)",
          "Personal Investigador en Formación, Universidad Autónoma de Madrid, España (2016–2018)",
          "Docencia parcial en INACAP, Universidad del Mar, UCCuyo"
        ],
        publicationsTitle: "Publicaciones",
        projectsTitle: "Proyectos de investigación",
        projects: [
          { title: "Fortalece PyME Coquimbo – Red de asistencia digital", role: "Co-ejecutor", period: "2022", funding: "CORFO / ASOEX" },
          { title: "Nodo Laboratorio Natural Océano Centro-Norte (NODOSLN0006)", role: "Investigador", period: "2022", funding: "ANID, Chile" },
          { title: "Sistematización avances Corredor Bioceánico Central y Túnel Agua Negra", role: "Investigador", period: "2021", funding: "AGCID, Chile" },
          { title: "Optimización de la gestión de residuos en salud (IT20I10084)", role: "Investigador", period: "2021", funding: "FONDEF IDeA" }
        ],
        conferencesTitle: "Presentaciones en Congresos",
        conferences: [
          { title: "Transformación tecnológica para PYMES del sector agrícola", event: "Seminario Internacional AGRO 5.0, U. Católica de Cuyo, Argentina", year: "2023" },
          { title: "Crisis hídrica en Chile: acciones a nivel micro", event: "Conversatorio regional sobre crisis hídrica", year: "2022" },
          { title: "Beyond GDP: socioeconomic diversity of European regions", event: "QuaRCS-lab Webinar Series", year: "2020" }
        ],
        skillsTitle: "Capacidades",
        skills: {
          languagesTitle: "Idiomas",
          languages: ["Español (nativo)", "Inglés (avalado)", "Portugués (básico)"],
          programmingTitle: "Programación y software",
          programming: ["R", "Gretl", "Mathematica", "GAMS", "Python", "ArGIS", "LaTeX", "MS Office"],
          otherTitle: "Áreas de interés",
          other: ["Economía urbana y regional","Concentración espacial","Redes de innovación","Valoración económica de ecosistemas"]
        },
        awardsTitle: "Becas y Premios",
        awards: []
      },
      en: {
        title: "Curriculum Vitae Andres Marcelo Vallone",
        nav: ["General Information","Education","Experience","Publications","Research Projects","Conference Presentations","Skills","Scholarships & Awards"],
        generalTitle: "General Information",
        generalText: "Affiliation: Universidad Católica del Norte, School of Business Sciences – Institute of Public Policies, Coquimbo, Chile.",
        summary: "Associate Professor at UCN. PhD in Economics and Business (UAM, 2019). Fields: urban and regional economics, innovation networks, spatial analysis.",
        educationTitle: "Education",
        education: [
          { degree: "PhD in Economics and Business", institution: "Universidad Autónoma de Madrid, Spain", years: "2015 – 2019" },
          { degree: "Master in Regional Science", institution: "Universidad Católica del Norte, Antofagasta, Chile", years: "2009 – 2011" },
          { degree: "MBA – Master in Business Administration", institution: "Universidad Católica del Norte, Coquimbo, Chile", years: "2007 – 2009" },
          { degree: "Master in Economics and Strategic Business Administration", institution: "Universidad Católica de Cuyo, Argentina", years: "2006 – 2009" },
          { degree: "BA in Economics", institution: "Universidad Católica de Cuyo, Argentina", years: "1997 – 2004" }
        ],
        experienceTitle: "Experience",
        teachingExpTitle: "Teaching experience",
        undergradTitle: "Undergraduate",
        postgradTitle: "Postgraduate",
        undergradCourses: [
          "Macroeconomics II – UCN, Coquimbo (2011–Present)",
          "Microeconomics I – UCN, Coquimbo (2011–Present)",
          "Microeconomics II – UCN, Coquimbo (2011–Present)",
          "Economic and Social Environment – UCN",
          "Introduction to Economics – UCN",
          "Industrial Organization – UCN",
          "Optimization – UCN Antofagasta (2008–2010)",
          "International Economics – UCCuyo (2005–2007)"
        ],
        postgradCourses: [
          "Teaching and research support, Dept. of Applied Economics, UAM (2016–2018)"
        ],
        otherExpTitle: "Other experience",
        otherExperience: [
          "Full-time professor, Universidad Católica del Norte, Coquimbo, Chile (2011–present)",
          "Research Fellow, Universidad Autónoma de Madrid, Spain (2016–2018)",
          "Part-time teaching, INACAP, Universidad del Mar, UCCuyo"
        ],
        publicationsTitle: "Publications",
        projectsTitle: "Research projects",
        conferencesTitle: "Conference Presentations",
        skillsTitle: "Skills",
        skills: {
          languagesTitle: "Languages",
          languages: ["Spanish (native)", "English (accredited)", "Portuguese (basic)"],
          programmingTitle: "Programming & software",
          programming: ["R", "Gretl", "Mathematica", "GAMS", "Python", "ArGIS", "LaTeX", "MS Office"],
          otherTitle: "Research interests",
          other: ["Urban and regional economics","Spatial concentration","Innovation networks","Economic valuation of ecosystems"]
        },
        awardsTitle: "Scholarships & Awards",
        awards: []
      }
    };

    let currentLang = "es";
    let pubsCache = [];

    /* ===== PARSE BIBTEX ===== */
    function parseBibtex(bibtex) {
      const entries = [];
      const raw = bibtex.split(/@(?=[a-zA-Z]+)/g).filter(Boolean);
      for (const chunk of raw) {
        const typeMatch = chunk.match(/^([a-zA-Z]+)\s*{/);
        if (!typeMatch) continue;
        const type = typeMatch[1].toLowerCase();
        const keyMatch = chunk.match(/^[a-zA-Z]+\s*{\s*([^,]+),/);
        const key = keyMatch ? keyMatch[1].trim() : "";
        const body = chunk.substring(chunk.indexOf("{") + 1, chunk.lastIndexOf("}"));
        const fields = {};
        const fieldRegex = /(\w+)\s*=\s*(\{(?:[^{}]|{[^{}]*})*\}|"[^"]*")\s*,?/g;
        let m;
        while ((m = fieldRegex.exec(body)) !== null) {
          const name = m[1].toLowerCase();
          let val = m[2].trim();
          if ((val.startsWith("{") && val.endsWith("}")) || (val.startsWith('"') && val.endsWith('"'))) {
            val = val.slice(1, -1);
          }
          fields[name] = val.replace(/\s+/g, " ").trim();
        }
        entries.push({ type, key, ...fields });
      }
      return entries;
    }

    function formatAuthorsAPA(authStr) {
      if (!authStr) return "";
      const parts = authStr.split(/\s+and\s+/i).map(a => a.trim()).filter(Boolean);
      const formatted = parts.map(a => {
        if (a.includes(",")) {
          const [last, firstsRaw] = a.split(",").map(x => x.trim());
          const initials = (firstsRaw || "").split(/\s+/).filter(Boolean).map(n => n[0].toUpperCase() + ".").join(" ");
          return `${last}, ${initials}`.trim();
        } else {
          const tokens = a.split(/\s+/);
          const last = tokens.pop();
          const initials = tokens.map(n => n[0].toUpperCase() + ".").join(" ");
          return `${last}, ${initials}`.trim();
        }
      });
      if (formatted.length === 1) return formatted[0];
      if (formatted.length === 2) return formatted.join(" & ");
      return formatted.slice(0, -1).join(", ") + ", & " + formatted[formatted.length - 1];
    }

    async function loadPublicationsFromBib(path = "library.bib") {
      try {
        const res = await fetch(path);
        if (!res.ok) throw new Error("No se pudo leer " + path);
        const txt = await res.text();
        pubsCache = parseBibtex(txt);
      } catch (e) {
        console.warn(e.message);
        pubsCache = [];
      }
    }

    /* ===== RENDER ===== */
    function renderEducation(lang) {
      const list = document.getElementById("education-list");
      list.innerHTML = "";
      content[lang].education.forEach(item => {
        const li = document.createElement("li");
        li.className = "edu-item";
        li.innerHTML = `
          <div class="edu-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="#5e7050">
              <path d="M32 6 2 20l30 14 30-14L32 6zm0 30.6L10 26v12l22 10 22-10V26L32 36.6z"/>
            </svg>
          </div>
          <div class="edu-content">
            <strong>${item.degree}</strong> – ${item.institution}<br>
            <small>${item.years}</small>
          </div>
        `;
        list.appendChild(li);
      });
    }

    function renderTeachingExperience(lang) {
      document.getElementById("teaching-exp-title").innerText = content[lang].teachingExpTitle;
      document.getElementById("undergrad-title").innerText = content[lang].undergradTitle;
      document.getElementById("postgrad-title").innerText = content[lang].postgradTitle;
      const ugList = document.getElementById("undergrad-list");
      const pgList = document.getElementById("postgrad-list");
      ugList.innerHTML = "";
      pgList.innerHTML = "";
      content[lang].undergradCourses.forEach(c => { const li = document.createElement("li"); li.textContent = c; ugList.appendChild(li); });
      content[lang].postgradCourses.forEach(c => { const li = document.createElement("li"); li.textContent = c; pgList.appendChild(li); });
    }

    function renderOtherExperience(lang) {
      document.getElementById("other-exp-title").innerText = content[lang].otherExpTitle;
      const list = document.getElementById("other-exp-list");
      list.innerHTML = "";
      content[lang].otherExperience.forEach(exp => { const li = document.createElement("li"); li.textContent = exp; list.appendChild(li); });
    }

    function renderSkills(lang) {
      const container = document.getElementById("skills-grid");
      container.innerHTML = "";
      const s = content[lang].skills;
      const card1 = document.createElement("div");
      card1.className = "skill-card";
      card1.innerHTML = `<h3>${s.languagesTitle}</h3><ul>${s.languages.map(i => `<li>${i}</li>`).join("")}</ul>`;
      const card2 = document.createElement("div");
      card2.className = "skill-card";
      card2.innerHTML = `<h3>${s.programmingTitle}</h3><ul>${s.programming.map(i => `<li>${i}</li>`).join("")}</ul>`;
      const card3 = document.createElement("div");
      card3.className = "skill-card";
      card3.innerHTML = `<h3>${s.otherTitle}</h3><ul>${s.other.map(i => `<li>${i}</li>`).join("")}</ul>`;
      container.appendChild(card1); container.appendChild(card2); container.appendChild(card3);
    }

    function renderAwards(lang) {
      document.getElementById("awards-title").innerText = content[lang].awardsTitle;
      const container = document.getElementById("awards-list");
      container.innerHTML = "";
      content[lang].awards.forEach(a => {
        const div = document.createElement("div");
        div.className = "award-item";
        div.innerHTML = `<strong>${a.name}</strong> – ${a.description}<br><small>${a.year}</small>`;
        container.appendChild(div);
      });
    }

    function renderProjects(lang) {
      document.getElementById("projects-title").innerText = content[lang].projectsTitle;
      const list = document.getElementById("projects-list");
      list.innerHTML = "";
      const projects = [...content[lang].projects].sort((a,b) => (b.period||"").localeCompare(a.period||""));
      projects.forEach(p => {
        const year = p.period || "";
        const li = document.createElement("li");
        li.className = "card-list-item";
        li.innerHTML = `
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#bc7d38"><path d="M9 2h6v2h3v18H6V4h3V2zm2 2v1h2V4h-2z"/></svg>
          </div>
          <div>
            <strong>${year}</strong> – ${p.title}<br>
            ${p.role ? p.role + ". " : ""}${p.funding ? p.funding : ""}
          </div>
        `;
        list.appendChild(li);
      });
    }

    // publicaciones con abstract
    function renderPublications() {
      document.getElementById("publications-title").innerText = content[currentLang].publicationsTitle;
      const list = document.getElementById('publications-list');
      list.innerHTML = "";
      const pubs = [...pubsCache].sort((a,b) => (b.year||"").localeCompare(a.year||""));
      pubs.forEach(pub => {
        const li = document.createElement('li');
        li.className = "card-list-item";
        const icon = document.createElement('div');
        icon.className = 'card-icon';
        icon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#5e7050">
            <path d="M19 2H8a3 3 0 0 0-3 3v14a3 3 0 0 1 3-3h11v-2H8a5 5 0 0 0-3 1V5a1 1 0 0 1 1-1h12v14h2V2z"/>
          </svg>
        `;
        const contentDiv = document.createElement('div');

        const authorsAPA = formatAuthorsAPA(pub.author);
        const year = pub.year ? `(${pub.year}).` : "(s.f.).";
        const title = pub.title ? pub.title.replace(/\.$/, "") + "." : "";
        const outlet = pub.journal || pub.booktitle || "";
        const outletHtml = outlet ? `<em>${outlet}</em>` : "";
        const volume = pub.volume ? `<em>${pub.volume}</em>` : "";
        const number = pub.number ? `(${pub.number})` : "";
        const pages = pub.pages ? `, ${pub.pages}` : "";
        const doi = pub.doi ? ` https://doi.org/${pub.doi.replace(/^https?:\/\/doi\.org\//, "")}` : (pub.url ? ` ${pub.url}` : "");
        const abstract = pub.abstract ? pub.abstract : "";

        contentDiv.innerHTML = `
          <div class="pub-meta">
            ${authorsAPA} ${year} ${title} ${outletHtml}${outletHtml && (volume || number) ? ", " : ""}${volume}${number}${pages}.${doi}
          </div>
          ${abstract ? `<div class="pub-abstract"><strong>${currentLang === "es" ? "Resumen:" : "Abstract:"}</strong> ${abstract}</div>` : ""}
        `;
        li.appendChild(icon);
        li.appendChild(contentDiv);
        list.appendChild(li);
      });
    }

    // presentaciones de nuevo desde el objeto content
    function renderConferences(lang) {
      document.getElementById("conferences-title").innerText = content[lang].conferencesTitle;
      const list = document.getElementById("conferences-list");
      list.innerHTML = "";
      content[lang].conferences.forEach(item => {
        const li = document.createElement("li");
        li.className = "card-list-item";
        li.innerHTML = `
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#5e7050">
              <path d="M3 4h18v10H3zM8 18l-3 3h2l2-2 2 2h2l-3-3z"/>
            </svg>
          </div>
          <div>
            <strong>${item.year}</strong> – ${item.title}<br>
            ${item.event}
          </div>
        `;
        list.appendChild(li);
      });
    }

    function renderAll(lang) {
      const t = content[lang];
      document.getElementById("title").innerText = t.title;
      document.getElementById("nav-general").innerText = t.nav[0];
      document.getElementById("nav-education").innerText = t.nav[1];
      document.getElementById("nav-experience").innerText = t.nav[2];
      document.getElementById("nav-publications").innerText = t.nav[3];
      document.getElementById("nav-projects").innerText = t.nav[4];
      document.getElementById("nav-conferences").innerText = t.nav[5];
      document.getElementById("nav-skills").innerText = t.nav[6];
      document.getElementById("nav-awards").innerText = t.nav[7];

      document.getElementById("general-title").innerText = t.generalTitle;
      document.getElementById("general-text").innerText = t.generalText;
      document.getElementById("summary-text").innerText = t.summary;
      document.getElementById("education-title").innerText = t.educationTitle;
      document.getElementById("experience-title").innerText = t.experienceTitle;
      document.getElementById("publications-title").innerText = t.publicationsTitle;
      document.getElementById("projects-title").innerText = t.projectsTitle;
      document.getElementById("conferences-title").innerText = t.conferencesTitle;
      document.getElementById("skills-title").innerText = t.skillsTitle;
      document.getElementById("awards-title").innerText = t.awardsTitle;

      renderEducation(lang);
      renderTeachingExperience(lang);
      renderOtherExperience(lang);
      renderSkills(lang);
      renderAwards(lang);
      renderProjects(lang);
      renderConferences(lang);
      // publicaciones se vuelven a pintar con el idioma (para el "Resumen:")
      renderPublications();
    }

    function toggleLanguage() {
      currentLang = currentLang === "es" ? "en" : "es";
      renderAll(currentLang);
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await loadPublicationsFromBib("library.bib");
      renderAll("es");
    });
  </script>
</body>
</html>
